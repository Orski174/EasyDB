-- Find warehouses storing the most expensive product and its details.

WITH ProductPrice AS (
    SELECT 
        Product_Name, 
        MAX(Price_per_unit) AS max_price
    FROM 
        Product
)
SELECT 
    w.warehouse_name, 
    p.product_name, 
    pp.max_price
FROM 
    Warehouses w
JOIN 
    BLOCK b ON w.WH_Name = b.WH_Name
JOIN
    Contains_Product cp on b.Block_ID = cp.Block_ID  
JOIN 
    ProductPrice pp ON p.Product_Name = pp.Product_Name
ORDER BY 
    pp.max_price DESC;