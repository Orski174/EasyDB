-- Find the machines that have operated for the longest cumulative days, grouped by department.

SELECT 
    d.Dep_Name AS department_name, 
    m.machine_name,
    m.machine_number, 
    DATEDIFF(CURRENT_DATE, m.First_Used) AS total_days_operated
FROM 
    Machines m
JOIN 
    Department_Occupies d ON m.room_ID = d.room_ID
GROUP BY 
    d.Dep_Name, m.machine_numebr, m.machine_name, m.First_Used
ORDER BY 
    d.Dep_Name, total_days_operated DESC;